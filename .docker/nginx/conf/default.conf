server_tokens off;

server {
  listen 80;
  error_log /var/log/nginx/error.log;
  client_max_body_size 40M;
  fastcgi_read_timeout        600;
  proxy_connect_timeout       600;
  proxy_send_timeout          600;
  proxy_read_timeout          600;
  send_timeout                600;
  gzip on;
  gzip_comp_level 2;
  gzip_min_length 1000;
  gzip_proxied expired no-cache no-store private auth;
  gzip_types text/plain application/x-javascript text/xml;
  root /moodle/web;
  index index.php index.html;
  error_page 403 404 405 500 501 502 503 504 /static/404.html;
  autoindex on;

# block read dot files
  location ~ \.(sh|htaccess|env|git|docker) {
    return 404;
  }

  location /dataroot/ {
      internal;
      alias <full_moodledata_path>; # ensure the path ends with /
  }

  location ~ [^/]\.php(/|$) {
    fastcgi_split_path_info ^(.+\.php)(/.+)$;
    fastcgi_pass            php7:9000;
    fastcgi_index           index.php;
    include                 fastcgi_params;
    fastcgi_param           SCRIPT_FILENAME $document_root$fastcgi_script_name;
    fastcgi_param           PATH_INFO $fastcgi_path_info;
  }
}